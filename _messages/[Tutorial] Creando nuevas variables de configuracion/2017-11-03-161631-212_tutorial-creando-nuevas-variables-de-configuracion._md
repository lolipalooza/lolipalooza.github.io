---
thread: "[Tutorial] Creando nuevas variables de configuraci&oacute;n"
id_msg: 908021
date: "2017-11-03 16:16:31"

subject: "[Tutorial] Creando nuevas variables de configuraci&oacute;n"
user: "yab220sorgesoureDug"



icon: xx




---
<div align="center"><span style="font-size: 24pt;" class="bbc_size">&#9760; <strong><span style="font-family: andale mono;" class="bbc_font"><span style="color: pink;" class="bbc_color">[<span style="color: navy;" class="bbc_color">Tutorial</span>]</span></span></strong><br /><span style="font-family: impact;" class="bbc_font"><span style="color: purple;" class="bbc_color">Variables personalizadas de configuración para SMF</span></span></span></div><br /><br />Este tutorial no está completo, y puede que sobre la marcha vayamos descubriendo más cosas, al respecto. Sin embargo, aquí plasmo todo lo que he podido descubrir hasta el momento sobre SMF.<br /><br /><div align="center"><span style="font-family: arial;" class="bbc_font"><span style="font-size: 18pt;" class="bbc_size"><span style="color: orange;" class="bbc_color">&#9827;</span> Variables personalizadas</span></span></div><br />Estas variables se almacenan en la base de datos, en la tabla <span style="font-family: courier;" class="bbc_font"><em>smf_themes</em></span>, y lo que es mejor: una para cada usuario. Lo que significa que en éstas variables podemos guardar info de configuración de cada usuario, y hasta datos de personalización de su cuenta y su apariencia.<br /><br /><strong>¿Cómo hacemos funcionar la magia?</strong><br /><br />Pasos mínimos:<br /><br />Debes buscar la parte entre los templates donde se colocan los formularios de configuración. Muy seguramente solo vamos a estar trabajando sobre Profile.template, ya que es allí donde están los templates correspondientes a <em>Mi Perfil &gt; Config de Apariencia y diseño</em>, así como de <em>Mi Perfil &gt; Ultimate Profile</em>, pero si lo necesitan, pueden trabajar sobre otro template o creas sus propios templates.<br /><br />Una vez hayan decidido dónde quieren que aparesca su opción de configuración, deberán tener en mente qué tipo de dato será el de su configuración. Podría ser una variable binaria (flag), que se manipularía mediante un simple checkbox, o podría ser un texto, o un número. Sólo voy a explicar cómo vendría a funcionar la cosa para los flags, y cuento con que eso ya les debe dar la idea de cómo funciona el resto. Para que funcione, deberán agregar su opción de configuración con la siguiente estructura:<br /><br /><span style="font-family: courier;" class="bbc_font"><span style="color: gray;" class="bbc_color"><br />&lt;dl&gt;<br />&nbsp; &nbsp; &lt;dt&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;strong&gt;&#039;, $txt&#91;&#039;<span style="color: purple;" class="bbc_color"><strong>tu_texto_personalizado</strong></span>&#039;], &#039;&lt;/strong&gt;<br />&nbsp; &nbsp; &lt;/dt&gt;<br />&nbsp; &nbsp; &lt;dd&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;hidden&quot; name=&quot;default_options[<span style="color: purple;" class="bbc_color"><strong>tu_variable</strong></span>]&quot; value=&quot;0&quot; /&gt;&lt;input class=&quot;input_check&quot; type=&quot;checkbox&quot; name=&quot;default_options[<span style="color: purple;" class="bbc_color"><strong>tu_variable</strong></span>]&quot;&#039;, (@$context&#91;&#039;member&#039;]&#91;&#039;options&#039;]&#91;&#039;<span style="color: purple;" class="bbc_color"><strong>tu_variable</strong></span>&#039;] == 1) ? &#039; checked=&quot;checked&quot;&#039; : &#039;&#039;, &#039; value=&quot;1&quot; /&gt;<br />&nbsp; &nbsp; &lt;/dd&gt;<br />&lt;/dl&gt;<br /></span></span><br /><br />ó<br /><br /><span style="font-family: courier;" class="bbc_font"><span style="color: gray;" class="bbc_color"><br />&lt;li&gt;<br />&nbsp; &nbsp; &lt;input type=&quot;hidden&quot; name=&quot;default_options[<span style="color: purple;" class="bbc_color"><strong>tu_variable</strong></span>]&quot; value=&quot;0&quot; /&gt;<br />&nbsp; &nbsp; &lt;label for=&quot;le_tset&quot;&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;checkbox&quot; name=&quot;default_options[<span style="color: purple;" class="bbc_color"><strong>tu_variable</strong></span>]&quot; id=&quot;<span style="color: purple;" class="bbc_color"><strong>tu_variable</strong></span>&quot; value=&quot;1&quot;&#039;, !empty($context&#91;&#039;member&#039;]&#91;&#039;options&#039;]&#91;&#039;<span style="color: purple;" class="bbc_color"><strong>tu_variable</strong></span>&#039;]) ? &#039; checked=&quot;checked&quot;&#039; : &#039;&#039;, &#039; class=&quot;input_check&quot; /&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; &#039;, $txt&#91;&#039;<span style="color: purple;" class="bbc_color"><strong>tu_texto_personalizado</strong></span>&#039;], &#039;<br />&nbsp; &nbsp; &lt;/label&gt;<br />&lt;/li&gt;<br /></span></span><br /><br />Estos son solo dos ejemplos. Analicen el resto de las opciones de configuración y compárenlas con su equivalente en php + html. Una vez agregados dichos cambios, cuando ingresas a la pantalla de configuración, marcas las casillas y guardas, el código internamente crea nuevas entradas en la base de datos, en la tabla <span style="font-family: courier;" class="bbc_font"><em>smf_themes</em></span> de la siguiente forma:<br /><br /><table class="bbc_table"><tr><td>id_member</td><td>id_theme</td><td>variable</td><td>value</td></tr><tr><td>el id del miembro que está guardando su configuración</td><td>el id del theme en donde se están haciendo los cambios (lo que vendría a significar que se necesitaría establecer valores en cada theme...? habrá que ver.</td><td>&quot;tu_variable&quot; (es la etiqueta que tú le pusiste antes a nivel de código)</td><td>el valor (&quot;0&quot; ó &quot;1&quot;) para el caso de los flags</td></tr></table><br />Luego, podrán ingresar a sus respectivos valores desde otras templates gracias a la variable global <span style="font-family: courier;" class="bbc_font"><span style="color: teal;" class="bbc_color">$options[<span style="color: purple;" class="bbc_color"><strong>&#039;tu_variable&#039;</strong></span>]</span></span> o alternativamente mediante <span style="font-family: courier;" class="bbc_font"><span style="color: teal;" class="bbc_color">$context&#91;&#039;member&#039;]&#91;&#039;options&#039;][<span style="color: purple;" class="bbc_color"><strong>&#039;tu_variable&#039;</strong></span>]</span></span>.<br /><br /><span style="font-size: 12pt;" class="bbc_size"><strong>Importante:</strong></span> nótese que existe una enorme diferencia entre ingresar a nuestras variables mediante <span style="font-family: courier;" class="bbc_font"><span style="color: teal;" class="bbc_color">$options[<span style="color: purple;" class="bbc_color"><strong>&#039;tu_variable&#039;</strong></span>]</span></span> ó mediante <span style="font-family: courier;" class="bbc_font"><span style="color: teal;" class="bbc_color">$context&#91;&#039;member&#039;]&#91;&#039;options&#039;][<span style="color: purple;" class="bbc_color"><strong>&#039;tu_variable&#039;</strong></span>]</span></span>. La primera es sólo para datos propios de <strong>nuestra cuenta</strong>. La segunda nos permite ver los datos de <strong>las cuentas de otros usuarios</strong>, dependiendo de cuál sea el valor de <span style="font-family: courier;" class="bbc_font"><span style="color: teal;" class="bbc_color">$context[<span style="color: purple;" class="bbc_color"><strong>&#039;member&#039;</strong></span>]</span></span>.<br /><br />Fácil ¿eh?<br /><br />Con ésto en mente ya no tienen excusa para hacer lo que os venga en gana para crear nuevas opciones de configuración, incluyendo las mentadas personalizaciones de posts/nicknames/custom titles, entre otras weás...<br /><br /><br /><br /><br /><div align="center"><span style="font-family: arial;" class="bbc_font"><span style="font-size: 18pt;" class="bbc_size"><span style="color: orange;" class="bbc_color">&#65533;</span> Dudas sin resolver</span></span></div><br />Si nos vamos al archivo <span style="font-family: andale mono;" class="bbc_font"><em>/Themes/(default ó core)/<strong>Settings.template.php</strong></em></span>, encontraremos en la función <span style="font-family: courier;" class="bbc_font">template_options()</span> un montón de definiciones para las opciones de configuración que nos aparece en <em>&gt; Configuración de Apariencia y Diseño</em>, donde la estructura de la definición es más o menos como sigue:<br /><br /><span style="font-family: courier;" class="bbc_font"><span style="color: blue;" class="bbc_color"><strong>array</strong>(</span><br />&nbsp; &nbsp; &#039;<span style="color: gray;" class="bbc_color">id</span>&#039; <span style="color: blue;" class="bbc_color">=&gt;</span> &#039;<span style="color: gray;" class="bbc_color">el_nombre_de_la_variable</span>&#039;<span style="color: blue;" class="bbc_color">,</span><br />&nbsp; &nbsp; &#039;<span style="color: gray;" class="bbc_color">label</span>&#039; <span style="color: blue;" class="bbc_color">=&gt;</span> $txt<span style="color: blue;" class="bbc_color">[</span>&#039;<span style="color: gray;" class="bbc_color">label_del_texto</span>&#039;<span style="color: blue;" class="bbc_color">],</span><br />&nbsp; &nbsp; &#039;<span style="color: gray;" class="bbc_color">default</span>&#039; <span style="color: blue;" class="bbc_color">=&gt;</span> <span style="color: blue;" class="bbc_color"><strong>true</strong>,</span><br /><span style="color: blue;" class="bbc_color">),</span></span><br /><br />La pregunta es: ¿para qué sirve ésto exactamente? Porque yo pude colocar una opción personalizada en <em>&gt; Configuración de Apariencia y Diseño</em>, y funcionó sin necesidad de que dicha opción apareciése aquí. ¿Acaso será para establecer valores por defecto? Pero lo raro es que casi todas las entradas dicen <span style="font-family: courier;" class="bbc_font">&#039;<span style="color: blue;" class="bbc_color"><strong>true</strong></span>&#039;</span> por defecto, y aún así muchas de estas opciones aparecen desmarcadas para cualquier usuario regular....<br /><br />Queda pendiente dicha duda.
