---
thread: "[SMF] Arreglando la funcionalidad &quot;Edit Reason&quot;"
id_msg: 629408
date: "2017-10-26 15:58:10"

subject: "[SMF] Arreglando la funcionalidad &quot;Edit Reason&quot;"
user: "yap320sorgesoureDug"

modified_time: 2017-10-26 18:08:56
modified_name: "yap320sorgesoureDug"
icon: xx



edit_reason: "pos no'más :'v"
---
<div align="center"><span style="font-size: 18pt;" class="bbc_size"><span style="font-family: georgia;" class="bbc_font"><strong><span class="bbc_u"><span style="color: purple;" class="bbc_color">[<span style="color: red;" class="bbc_color">SMF</span>] Arreglando la funcionalidad &quot;<span style="color: brown;" class="bbc_color">Edit Reason</span>&quot;</span></span></strong></span></span></div><br />Así es kabrones, porque los malparidos joputas que la desarrollaron en primer término dejaron un montón de huecos por todos lados. Huecos que ahora nos toca a nosotros &quot;rellenar&quot;. ¡Acompáñennos!<br /><br /><span style="font-size: 14pt;" class="bbc_size">1. campo &quot;razón de edición&quot; vacío</span><br /><br />Primero que nada, debemos arreglar el detalle de que cuando uno edita un post, creando la razón de edición, y luego vuelve a querer editar, entonces en el campo de &quot;razón de edición&quot; no aparece nada, produciendo que tengamos que volver a colocarla en el caso de que deseemos conservarla. Para arreglar eso y hacer que nos aparesca dicho campo ya inicializado con su respectivo valor previo debemos realizar los siguientes cambios:<br /><br />En el controlador <strong>./Sources/Post.php</strong>:<br /><br /><div class="quoteheader"><div class="topslice_quote">Citar</div></div><blockquote class="bbc_standard_quote">Buscar el siguiente bloque:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">&nbsp;&nbsp;&nbsp;// Editing a message...<br />&nbsp;&nbsp;&nbsp;elseif (isset($_REQUEST&#91;&#039;msg&#039;]) &amp;&amp; !empty($topic))<br />&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_REQUEST&#91;&#039;msg&#039;] = (int) $_REQUEST&#91;&#039;msg&#039;];<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the existing message.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request = $smcFunc&#91;&#039;db_query&#039;](&#039;&#039;, &#039;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.id_member, m.modified_time, m.smileys_enabled, m.body,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.poster_name, m.poster_email, m.subject, m.icon, m.approved,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IFNULL(a.size, -1) AS filesize, a.filename, a.id_attach,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.approved AS attachment_approved, t.id_member_started AS id_member_poster,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.poster_time</code><br />Agregar al final, despues de <em>m.poster_time</em>:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">m.poster_time, m.edit_reason</code></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><div class="quoteheader"><div class="topslice_quote">Citar</div></div><blockquote class="bbc_standard_quote">Buscar:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the stuff ready for the form.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$form_subject = $row&#91;&#039;subject&#039;];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$form_message = un_preparsecode($row&#91;&#039;body&#039;]);</code><br />Agregar debajo:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$edit_reason = $row&#91;&#039;edit_reason&#039;];</code></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><div class="quoteheader"><div class="topslice_quote">Citar</div></div><blockquote class="bbc_standard_quote">Buscar:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">&nbsp;&nbsp;&nbsp;$context&#91;&#039;subject&#039;] = addcslashes($form_subject, &#039;&quot;&#039;);<br />&nbsp;&nbsp;&nbsp;$context&#91;&#039;message&#039;] = str_replace(array(&#039;&quot;&#039;, &#039;&lt;&#039;, &#039;&gt;&#039;, &#039;&amp;nbsp;&#039;), array(&#039;&amp;quot;&#039;, &#039;&amp;lt;&#039;, &#039;&amp;gt;&#039;, &#039; &#039;), $form_message);<br /></code><br />Agregar debajo:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">&nbsp;&nbsp;&nbsp;if (isset($edit_reason))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$context&#91;&#039;edit_reason&#039;] = $edit_reason;<br /></code></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />En la vista <strong>./Themes/default/post.template.php</strong>:<br /><br /><div class="quoteheader"><div class="topslice_quote">Citar</div></div><blockquote class="bbc_standard_quote">Buscar:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">&lt;input type=&quot;text&quot; id=&quot;edit_reason&quot; name=&quot;edit_reason&quot; size=&quot;50&quot; value=&quot;&quot; /&gt;<br /></code><br />Reemplazar por:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">&lt;input type=&quot;text&quot; id=&quot;edit_reason&quot; name=&quot;edit_reason&quot; size=&quot;50&quot; value=&quot;&#039;, $context&#91;&#039;edit_reason&#039;], &#039;&quot; /&gt;<br /></code></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><strong>Nota:</strong> se da por sentado que el campo <em>input</em> ya tiene el id &quot;<em>edit_reason</em>&quot;, si no es así, no es necesario para que ésto funcione.<br /><br /><br /><br /><span style="font-size: 14pt;" class="bbc_size">2. No puedo insertar caracteres especiales en mi campo &quot;edit reason&quot;!</span><br /><br />Este error es comprensible puesto que quienes desarrollaron el mod sólo manejan el inglés, y por ende, dejaron por fuera el soporte a los caracteres especiales, pero no os preocupeis que para eso estoy sho!<br /><br /><br /><div class="quoteheader"><div class="topslice_quote">Citar</div></div><blockquote class="bbc_standard_quote">Buscar en el controlador <strong>./Sources/Post.php</strong>:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">$msgOptions&#91;&#039;edit_reason&#039;] = addslashes(strtr(htmlspecialchars(isset($_POST&#91;&#039;edit_reason&#039;]) ? $_POST&#91;&#039;edit_reason&#039;] : &#039;&#039;), array(&quot;\r&quot; =&gt; &#039;&#039;, &quot;\n&quot; =&gt; &#039;&#039;, &quot;\t&quot; =&gt; &#039;&#039;)));</code><br />Y reemplazar por:<br /><div class="codeheader">Código: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Seleccionar]</a></div><code class="bbc_code">$msgOptions&#91;&#039;edit_reason&#039;] = strtr($smcFunc&#91;&#039;htmlspecialchars&#039;](isset($_POST&#91;&#039;edit_reason&#039;]) ? $_POST&#91;&#039;edit_reason&#039;] : &#039;&#039;), array(&quot;\r&quot; =&gt; &#039;&#039;, &quot;\n&quot; =&gt; &#039;&#039;, &quot;\t&quot; =&gt; &#039;&#039;));</code></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><span style="font-size: 14pt;" class="bbc_size">JÁ</span><br />Mámenme. <img src="/assets/smf/smileys/tongue.gif" alt="&#58;tongue&#58;" title="tongue" class="smiley" />
